<YAML-META-INFO-START/>

<!--
id: 100001
tags:
  - tongji|统计
  - translate|翻译
cat: math
cdate: "2016.07.30"
mdate: "2016.08.10"
title: "统计数据分析样例:零膨胀泊松回归"
keyword: 
	-  数据分析样例
	-  零膨胀泊松回归
	- Zero-inflated Poisson
	- Regression
	- Stata Data Analysis
-->
<YAML-META-INFO-END/>

---

类型:翻译
翻译时间: 2016.07.30-2016.08.10
译者:alingse

---

##  统计数据分析样例:零膨胀泊松回归

### 翻译来源
[Stata Data Analysis Examples : Zero-inflated Poisson Regression](http://www.ats.ucla.edu/stat/stata/dae/zip.htm)

引用声明：

	Introduction to SAS.  UCLA: Statistical Consulting Group. 
	from http://www.ats.ucla.edu/stat/sas/notes2/ (accessed November 24, 2007).


**版本信息**: Code for this page was tested in Stata 12.

零膨胀泊松回归用于对有过量零值的count型数据进行建模。更进一步的，理论上认为count值中的大量的零值数据是由某个单独的作用机制生成的，并且这些超出的零值可以单独建模。

因此,**zip**模型有两部分，一个泊松计数模型和一个预测过量的逻辑模型。你可以在这里复习下这些数据分析样例,[泊松回归](http://www.ats.ucla.edu/stat/stata/dae/poissonreg.htm)和[逻辑回归](http://www.ats.ucla.edu/stat/stata/dae/logit.htm)(译者：加入翻译todo list)

**需要注意**  本文的目的是展示如何使用多样的数据分析命令。

这也不会覆盖研究者要做的所有研究过程。

特别的，没有包含数据清洗、假设检验、模型诊断和可能的后续分析。


#### 零膨胀泊松回归样例

样例 1.

学校管理者研究两个学校初中生一个学期内的出勤情况／旷课情况。 出勤率是由旷课的天数测量来的，也从学生的性别和数学、语言艺术的标准测试分数预测的。而大量学生这个学期都没有旷课。

样例 2.

国家野生动物生物学家想要对国家公园里有多少鱼被渔民捕了建模。

游客被问他们是否有露营者，群体里有多少人，群体里是否有小孩，他们抓了多少鱼。

有些游客是不钓鱼的，但是没有关于一个人是否钓鱼或不钓鱼的数据。有些游客钓鱼但是不捕任何鱼。所以数据里有过量的零值数据因为这些人不捕鱼。


<!-- 

Example 2. 

A study of the number of journal articles published by tenured faculty as a function of 
discipline (fine arts, science, social science, humanities, medical, 
etc).  To get tenure faculty must publish, i.e., there are  no tenured faculty with
zero publications.

Example 3.

A study by the county traffic court on the number of tickets received by teenagers 
as predicted by school performance, amount of driver training and gender.  Only individuals 
who have received at least one citation are in the traffic court files.
 -->

#### 数据说明

让我们接着上面的样例 2 

我们有250组去国家公园的群体的数据。每一组都被问询了

他们捕了多少鱼(**count**),他们里面有多少小孩(**child**),共有多少人(**persons**)以及他们是否带着帐篷去的(**camper**)

除了预测被捕的鱼的数量，预测过量零值的存在性也很有趣。

比如：这些零值不是简单的没钓到的霉运的结果而已。

我们的模型会用到变量**child**, **persons**, and **camper** 。先看一下数据。

**use http://www.stata-press.com/data/r10/fish, clear**

**count child persons camper 表**
 
     Variable |       Obs  |      Mean  |  Std. Dev.   |    Min    |    Max
 -------------+------------+------------+--------------+-----------+---
        count |       250  |     3.296  |  11.63503    |      0    |    149
        child |       250  |      .684  |  .8503153    |      0    |      3
      persons |       250  |     2.528  |   1.11273    |      1    |      4
       camper |       250  |      .588  |  .4931824    |      0    |      1
       

**count 直方图, 离散的频次**

![](../static/pic/fishhist.gif)

 
 
 **tab1 child persons camper**
 
```
-> 以child 制表
 
       child |      Freq.     Percent     累积占比
 ------------+-----------------------------------
           0 |        132       52.80       52.80
           1 |         75       30.00       82.80
           2 |         33       13.20       96.00
           3 |         10        4.00      100.00
 ------------+-----------------------------------
       Total |        250      100.00

```


```
 -> 以persons 制表
 
     persons |      Freq.     Percent     累积占比
 ------------+-----------------------------------
           1 |         57       22.80       22.80
           2 |         70       28.00       50.80
           3 |         57       22.80       73.60
           4 |         66       26.40      100.00
 ------------+-----------------------------------
       Total |        250      100.00
```
 
```
 -> 以 camper 制表
 
      camper |      Freq.     Percent        Cum.
 ------------+-----------------------------------
           0 |        103       41.20       41.20
           1 |        147       58.80      100.00
 ------------+-----------------------------------
       Total |        250      100.00
 
```

#### 你可能考虑的分析方法

下面是一些你可能已经碰到过的分析方法。
其中一些方法相当合理，而另一些则已经不新鲜了或者有限制。

*   零膨胀泊松回归 - 就是本页的内容
*   零膨胀负二项回归 - 负二项回归在处理分散数据上表现比较好，比如：方差比平均值大得多
的数据。
*   普通的计数模型 - 如果没有超量的零，回归模型或二项回归模型可能可能更合适。
*   普通最小二乘法（OLS）回归 - 你可能会试着用普通最小二乘法来分析这些数据。但是,计数数据是高度非正常的，而且用最小二乘法估计的并不好。

#### 零膨胀泊松回归

本文会运行**zip**命令，并以**child**和**camper**作为捕鱼数量的预测因素，**persons** 作为过量零值的预测因素。也包含了**vuong**选项用来提供零膨胀模型与标准回归模型间的测量。

**zip count child camper, inflate(persons) vuong**

```
Fitting constant-only model:

Iteration 0:   log likelihood =  -1347.807  
Iteration 1:   log likelihood = -1315.5343  
Iteration 2:   log likelihood = -1126.3689  
Iteration 3:   log likelihood = -1125.5358  
Iteration 4:   log likelihood = -1125.5357  
Iteration 5:   log likelihood = -1125.5357  

Fitting full model:

Iteration 0:   log likelihood = -1125.5357  
Iteration 1:   log likelihood = -1044.8553  
Iteration 2:   log likelihood = -1031.8733  
Iteration 3:   log likelihood = -1031.6089  
Iteration 4:   log likelihood = -1031.6084  
Iteration 5:   log likelihood = -1031.6084  

Zero-inflated Poisson regression                  Number of obs   =        250
                                                  Nonzero obs     =        108
                                                  Zero obs        =        142

Inflation model = logit                           LR chi2(2)      =     187.85
Log likelihood  = -1031.608                       Prob > chi2     =     0.0000

------------------------------------------------------------------------------
       count |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
count        |
       child |  -1.042838   .0999883   -10.43   0.000    -1.238812    -.846865
    1.camper |   .8340222   .0936268     8.91   0.000      .650517    1.017527
       _cons |   1.597889   .0855382    18.68   0.000     1.430237     1.76554
-------------+----------------------------------------------------------------
inflate      |
     persons |  -.5643472   .1629638    -3.46   0.001    -.8837503    -.244944
       _cons |   1.297439   .3738522     3.47   0.001     .5647022    2.030176
------------------------------------------------------------------------------
Vuong test of zip vs. standard Poisson:            z =     3.57  Pr>z = 0.0002
```

这个结果看起来非常像是一个最小二乘法回归得到的结果:

*   Begins with the iteration log 
  giving the values of the log likelihoods starting
with a model that has no predictors.  The last value in the log is the final value
of the log likelihood for the full model and is repeated below.
*   Next comes the header information. On the right-hand side the number ofobservations used (250), number of nonzero observations (108) are given along with the likelihoodratio chi-squared.&nbsp;This compares the full model to a model without count predictors, giving adifference of two degrees of freedom.&nbsp; This is followed by the p-value forthe chi-square. The model, as a whole, is statistically significant.*   Below the header you will find the Poisson regression coefficients for each of thecount predicting variables
along with standard errors, z-scores, p-values and 95% confidence intervals for the
coefficients.
*   Following these are logit coefficients for the variable predicting excess zeros along
with its standard errors, z-scores, p-values and confidence intervals.
*   Below the various coefficients you will find the results of the Vuong test.  The
Vuong test compares the zero-inflated model with an ordinary poisson regression model.
A significant z-test indicates that the zero-inflated model is better.

Now we can move on to the specifics of the individual results.

*   Using the **robust** option has resulted in a fairly large change in the model chi-square,
which is now a Wald chi-square.&nbsp; This statistic is based on log pseudo-likelihoods instead oflog-likelihoods.
*   The coefficients for **child** and **camper** can be interpreted as follows:
	
	*   For each unit increase of child the expected log count of the response variable decreases by 1.043.
    *   Being a camper increases the expected log count by .834.

* The inflate coefficient for **persons** suggests that for each unit increase in person the log odds of an inflated zero decrease by.564.

We can use the **margins** (introduced in Stata 11) to help understand our model.  We will
first compute the expected counts for the categorical variable **camper** while holding the
continuous variable **child** at its mean value using the **atmeans** option.

**margins camper, atmeans**
><pre>
> 
> Adjusted predictions                              Number of obs   =        250
> Model VCE    : Robust
> 
> Expression   : Predicted number of events, predict()
> at           : child           =        .684 (mean)
>                0.camper        =        .412 (mean)
>                1.camper        =        .588 (mean)
>                persons         =       2.528 (mean)
> 
> ------------------------------------------------------------------------------
>              |            Delta-method
>              |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
> -------------+----------------------------------------------------------------
>       camper |
>           0  |   1.289132   .4393168     2.93   0.003     .4280866    2.150177
>           1  |   2.968305    .619339     4.79   0.000     1.754423    4.182187
> ------------------------------------------------------------------------------</pre>

The expected count for the number of fish caught by noncampers is 1.289 while for campers it is
2.968 at the means of **child** and **persons**.

<p>Using the **dydx** option computes the difference in expected counts between **camper** 
= 0 and **camper** = 1 while still holding **child** at its mean of .684 
and **persons** at its mean of 2.528.


> <pre><b>margins, dydx(camper) atmeans</b>
> 
> Conditional marginal effects    Number of obs   = 250
> Model VCE    : Robust
> 
> Expression   : Predicted number of events, predict()
> dy/dx w.r.t. : 1.camper
> at           : child           =        .684 (mean)
>                0.camper        =        .412 (mean)
>                1.camper        =        .588 (mean)
>                persons         =       2.528 (mean)
> 
> ------------------------------------------------------------------------------
>              |            Delta-method
>              |      dy/dx   Std. Err.      z    P>|z|     [95% Conf. Interval]
> -------------+----------------------------------------------------------------
>     1.camper |   1.679173   .7754611     2.17   0.030     .1592975    3.199049
> ------------------------------------------------------------------------------
> Note: dy/dx for factor levels is the discrete change from the base level.</pre>

<p>The difference in the number of fish caught by campers and noncampers is 1.679, which is
statistically significant.

One last **margins** command will give the expected counts for values of **child** 
from zero to three at both levels of **camper**. 

> <pre><b>margins, at(child=(0(1)3) camper=(0/1)) vsquish<b>
> 
> Predictive margins         Number of obs   =        250
> Model VCE    : Robust
> 
> Expression   : Predicted number of events, predict()
> 1._at        : child           =           0
>                camper          =           0
> 2._at        : child           =           0
>                camper          =           1
> 3._at        : child           =           1
>                camper          =           0
> 4._at        : child           =           1
>                camper          =           1
> 5._at        : child           =           2
>                camper          =           0
> 6._at        : child           =           2
>                camper          =           1
> 7._at        : child           =           3
>                camper          =           0
> 8._at        : child           =           3
>                camper          =           1
> 
> ------------------------------------------------------------------------------
>              |            Delta-method
>              |     Margin   Std. Err.      z    P>|z|     [95% Conf. Interval]
> -------------+----------------------------------------------------------------
>          _at |
>           1  |   2.616441   .6470522     4.04   0.000     1.348242     3.88464
>           2  |   6.024516   2.159288     2.79   0.005      1.79239    10.25664
>           3  |    .922172   .4142303     2.23   0.026     .1102954    1.734048
>           4  |   2.123358   .4771534     4.45   0.000     1.188154    3.058561
>           5  |   .3250221   .2611556     1.24   0.213    -.1868335    .8368777
>           6  |   .7483834   .3929987     1.90   0.057    -.0218798    1.518647
>           7  |    .114555   .1351887     0.85   0.397    -.1504101      .37952
>           8  |   .2637699   .2365495     1.12   0.265    -.1998587    .7273984
> ------------------------------------------------------------------------------
> 
> **marginsplot**
> 
> ![](zip_margins.png)
> 
> </pre>

The expected number of fish caught goes down as the number of children goes up 
for both people with and without campers.

A number of model fit indicators are available using the **fitstat** command, which is
part of the **spostado** utilities by J. Scott Long and Jeremy Freese (**findit spostado**).

> <pre>**fitstat**
> 
> Measures of Fit for zip of count
> 
> Log-Lik Intercept Only:      -1127.023   Log-Lik Full Model:          -1031.608
> D(244):                       2063.217   LR(4):                         190.829
>                                          Prob > LR:                       0.000
> McFadden's R2:                   0.085   McFadden's Adj R2:               0.079
> ML (Cox-Snell) R2:               0.534   Cragg-Uhler(Nagelkerke) R2:      0.534
> AIC:                             8.301   AIC*n:                        2075.217
> BIC:                           715.980   BIC':                         -168.743
> BIC used by Stata:            2090.824   AIC used by Stata:            2073.217</pre>

#### Things to consider

*   Since **zip** has both a count model and a logit
        model, each of the two models should have good predictors.  The two models do not        necessarily need to use the same predictors.
*   Problems of perfect prediction, separation or partial separation can occur in the
	logistic part of the zero-inflated model.
*   Count data often use exposure variables to indicate the number of times the event	could have happened. You can incorporate exposure into your model by using  the **exposure()**	option.
*   It is not recommended that zero-inflated poisson models be applied to	small samples.  What constitutes a small sample does not seem to be clearly defined
	in the literature.
*   Pseudo-R-squared values differ from OLS R-squareds, please see	[FAQ: What are	pseudo R-squareds?](http://www.ats.ucla.edu/stat/mult_pkg/faq/general/Psuedo_RSquareds.htm) for a discussion on this issue.

#### See also

*   Stata Online Manual

        *   [zip](http://www.stata.com/help.cgi?zip)

#### References

*   Cameron, A. Colin and Trivedi, P.K. (2009) Microeconometrics using stata. College Station, TX: StataPress.
*   Long, J. Scott, & Freese, Jeremy (2006). Regression Models for Categorical Dependent VariablesUsing Stata (Second Edition). College Station, TX: Stata Press.
*   Long, J. Scott (1997). Regression Models for Categorical and Limited Dependent Variables.Thousand Oaks, CA: Sage Publications.


#### translate from
Introduction to SAS.  UCLA: Statistical Consulting Group. 
from http://www.ats.ucla.edu/stat/sas/notes2/ (accessed November 24, 2007).
